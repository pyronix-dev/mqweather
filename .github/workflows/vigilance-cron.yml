name: Check Vigilance Status

on:
  schedule:
    - cron: '*/15 * * * *' # Run every 15 minutes
  workflow_dispatch: # Allow manual trigger

jobs:
  check-vigilance:
    runs-on: ubuntu-latest
    steps:
      - name: Call API Endpoint
        run: |
          if [ -z "${{ secrets.APP_URL }}" ]; then
            echo "::warning::Secrets APP_URL is not set. Skipping api call."
            exit 0
          fi
          
          echo "Checking vigilance status..."
          response=$(curl -s -w "%{http_code}" -X GET "${{ secrets.APP_URL }}/api/cron/check-vigilance")
          http_code=${response: -3}
          content=${response:0:${#response}-3}
          
          if [ "$http_code" -ne 200 ]; then
            echo "::error::Failed to check vigilance status. HTTP Code: $http_code"
            echo "Response: $content"
            exit 1
          fi
          
          echo "Success! Response: $content"
